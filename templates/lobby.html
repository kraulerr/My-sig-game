<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üéÑ –õ–æ–±–±–∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0a4d68 0%, #1a5f7a 50%, #0a4d68 100%);
            color: white;
            font-family: Arial;
            margin: 0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* –°–Ω–µ–∂–∏–Ω–∫–∏ */
        .snowflake {
            position: fixed;
            top: -10px;
            z-index: 1;
            color: white;
            font-size: 1em;
            animation: fall linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            font-size: 42px;
            text-shadow: 0 0 20px #FFD700;
            margin-bottom: 30px;
            animation: glow 2s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px #FFD700; }
            50% { text-shadow: 0 0 30px #FFA500; }
        }
        
        .container {
            display: flex;
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        .column {
            flex: 1;
            background: rgba(26, 95, 122, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h2 {
            color: #FFD700;
            margin-top: 0;
            text-align: center;
            font-size: 28px;
        }
        .player-card {
            background: rgba(15, 52, 96, 0.8);
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
            border: 2px solid transparent;
        }
        .player-card:hover {
            transform: translateX(5px);
            border-color: #FFD700;
        }
        .player-card.admin {
            border: 2px solid gold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #FFD700;
        }
        .team-card {
            background: rgba(30, 58, 95, 0.8);
            padding: 15px;
            margin: 15px 0;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: 0.3s;
        }
        .team-card:hover {
            border-color: #FFD700;
            transform: scale(1.02);
        }
        .team-members {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .member-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #FFD700;
        }
        .btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0a4d68;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
        }
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        .btn-admin {
            background: gold;
            color: #1a1a2e;
        }
        #admin-panel {
            text-align: center;
            margin-top: 20px;
            position: relative;
            z-index: 10;
        }
        #admin-panel .btn {
            font-size: 20px;
            padding: 15px 40px;
        }
    </style>
</head>
<body>
    <h1>üéÑ –ö–æ–º–Ω–∞—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è üéÅ</h1>
    
    <div class="container">
        <div class="column">
            <h2>üë• –ò–≥—Ä–æ–∫–∏</h2>
            <div id="players-list"></div>
        </div>
        
        <div class="column">
            <h2>üèÜ –ö–æ–º–∞–Ω–¥—ã</h2>
            <div id="teams-list"></div>
            <button class="btn" id="create-team-btn" style="display:none" onclick="createTeam()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        </div>
    </div>
    
    <div id="admin-panel" style="display:none">
        <button class="btn" onclick="startGame()">üéÑ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£ üéÅ</button>
    </div>

    <script>
        const socket = io();
        const myName = localStorage.getItem('myname');
        let isAdmin = false;

        // –°–Ω–µ–∂–∏–Ω–∫–∏
        function createSnowflakes() {
            const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 20; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(snowflake);
            }
        }
        createSnowflakes();

        socket.emit('join_lobby', {
            name: myName,
            avatar: localStorage.getItem('myavatar')
        });

        socket.on('lobby_update', (data) => {
            isAdmin = data.admin_sids.includes(socket.id);
            
            const pList = document.getElementById('players-list');
            pList.innerHTML = '';
            
            for (let [name, p] of Object.entries(data.players)) {
                if (p.team_id) continue;
                
                const isPlayerAdmin = p.is_admin;
                const cardClass = isPlayerAdmin ? 'player-card admin' : 'player-card';
                
                pList.innerHTML += `
                    <div class="${cardClass}">
                        <img src="/static/images/avatars/${p.avatar}" class="avatar">
                        <span>${name} ${isPlayerAdmin ? 'üëë' : ''}</span>
                        ${isAdmin && !isPlayerAdmin ? `<button class="btn btn-sm btn-admin" onclick="makeAdmin('${name}')">üëë</button>` : ''}
                        ${isAdmin ? getTeamButtons(name, data.teams) : ''}
                    </div>
                `;
            }
            
            const tList = document.getElementById('teams-list');
            tList.innerHTML = '';
            
            for (let [tid, team] of Object.entries(data.teams)) {
                tList.innerHTML += `
                    <div class="team-card">
                        <h3>üéÑ –ö–æ–º–∞–Ω–¥–∞ ${tid.slice(-1)}</h3>
                        <div>–ò–≥—Ä–æ–∫–æ–≤: ${team.members.length}</div>
                        <div class="team-members">
                            ${team.members.map(n => {
                                const player = data.players[n];
                                return `<img src="/static/images/avatars/${player.avatar}" class="member-avatar" title="${n}">`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('create-team-btn').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('admin-panel').style.display = isAdmin ? 'block' : 'none';
        });

        function getTeamButtons(playerName, teams) {
            let btns = '';
            for (let tid in teams) {
                btns += `<button class="btn btn-sm" onclick="assignTo('${playerName}', '${tid}')">‚Üí ${tid.slice(-1)}</button>`;
            }
            return btns;
        }

        function createTeam() { socket.emit('create_team'); }
        function assignTo(playerName, teamId) { socket.emit('assign_to_team', { player_name: playerName, team_id: teamId }); }
        function makeAdmin(playerName) {
            if (confirm(`–ù–∞–∑–Ω–∞—á–∏—Ç—å ${playerName} –∞–¥–º–∏–Ω–æ–º?`)) {
                socket.emit('make_admin', { player_name: playerName });
            }
        }
        function startGame() { socket.emit('start_game'); }
        socket.on('redirect_to_game', (d) => window.location.href = d.url);
    </script>
</body>
</html>